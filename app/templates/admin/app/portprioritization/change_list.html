{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block content_title %}{{ title }}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'vendors/fontawesome-free-5.1.0-web/css/all.css' %}">
    <link rel="stylesheet" href="{% static 'admin/css/port_prioritization.css' %}">
    <style>
        .port-prioritization-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .port-prioritization-header h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .port-prioritization-header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .priority-stats {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .priority-stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 5px;
            text-align: center;
            flex: 1;
        }
        
        .priority-stat .number {
            font-size: 18px;
            font-weight: bold;
        }
        
        .priority-stat .label {
            font-size: 11px;
            opacity: 0.8;
        }
        
        .quick-actions {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            text-decoration: none;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .quick-action-btn:hover {
            background: #218838;
            color: white;
            text-decoration: none;
        }
        
        .quick-action-btn.secondary {
            background: #6c757d;
        }
        
        .quick-action-btn.secondary:hover {
            background: #545b62;
        }
        
        .quick-action-btn.info {
            background: #17a2b8;
        }
        
        .quick-action-btn.info:hover {
            background: #138496;
        }
        
        .priority-legend {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .priority-legend h4 {
            margin-top: 0;
            font-size: 14px;
        }
        
        .priority-items {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .priority-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .priority-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .changelist-search {
            margin-bottom: 15px;
        }
        
        /* Enhance table appearance */
        #result_list {
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        #result_list th {
            background: #f8f9fa;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }
        
        #result_list tr:hover {
            background: #f8f9fa;
        }
        
        /* Let Django admin handle all styling naturally */
        
        /* Hide all possible save buttons in changelist */
        .actions {
            display: none !important;
        }
        
        /* Hide any form buttons at bottom */
        #changelist-form button,
        #changelist-form input[type="submit"],
        #changelist-form input[value="Save"] {
            display: none !important;
        }
        
        /* Hide pagination save buttons */
        .paginator button,
        .paginator input[type="submit"] {
            display: none !important;
        }
        
        /* Hide any remaining save elements */
        button[name="index"],
        input[name="index"],
        .submit-row {
            display: none !important;
        }
    </style>
{% endblock %}

{% block object-tools-items %}
    {{ block.super }}
    <a href="#" class="addlink" onclick="createDefaultRules(); return false;">
        Create default rules
    </a>
{% endblock %}

{% block content %}
    
    <div class="priority-legend">
        <h4><i class="fas fa-info-circle"></i> Priority Levels</h4>
        <div class="priority-items">
            <div class="priority-item">
                <span class="priority-dot" style="background: #dc3545;"></span>
                <span>Critical (1) - Gaming, VoIP</span>
            </div>
            <div class="priority-item">
                <span class="priority-dot" style="background: #fd7e14;"></span>
                <span>High (2) - Web browsing, Streaming</span>
            </div>
            <div class="priority-item">
                <span class="priority-dot" style="background: #28a745;"></span>
                <span>Normal (3) - Email, Downloads</span>
            </div>
            <div class="priority-item">
                <span class="priority-dot" style="background: #6c757d;"></span>
                <span>Low (4) - P2P, Background tasks</span>
            </div>
        </div>
    </div>
    
    {{ block.super }}
    
    <script>
        function createDefaultRules() {
            if (confirm('This will create default port prioritization rules for common applications. Continue?')) {
                fetch('{% url "admin:app_portprioritization_create_defaults" %}', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert(data.message);
                        location.reload();
                    } else if (data.status === 'info') {
                        alert(data.message);
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('Network error creating default rules');
                    console.error('Error:', error);
                });
            }
        }
        
        
        // Auto-refresh every 30 seconds to show updated stats
        setInterval(() => {
            if (!document.querySelector('.grp-module').style.display) {
                location.reload();
            }
        }, 30000);
    </script>
{% endblock %}